option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: app.py

  # Application environment variables (add your secrets via EB console for security)
  aws:elasticbeanstalk:application:environment:
    FLASK_ENV: production
    APP_ENV: prod
    # EXAMPLE_SECRET: some_value   # prefer using EB console or Parameter Store for secrets

packages:
  yum:
    git: []
    libjpeg-turbo-devel: []
    gcc: []
    make: []

commands:
  # early commands run before EB virtualenv is created
  01_create_artifacts_dir:
    command: "mkdir -p /var/app/current/artifacts"
    ignoreErrors: false

container_commands:
  # container_commands run after the application and virtualenv are set up.
  # Good for DB migrations, collectstatic, or extra installation steps.
  01_upgrade_pip:
    command: "/opt/python/run/venv/bin/pip install --upgrade pip"
  02_install_dill:
    command: "/opt/python/run/venv/bin/pip install dill"
  03_migrate:
    command: "/opt/python/run/venv/bin/python manage.py migrate"
    leader_only: true